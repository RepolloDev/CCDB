{% extends "layouts/crudLayout.html" %}
<!-- Title -->
{% block title %}
<span>Periodos</span>
{% endblock %}
<!-- Content -->
{% block content %}
<div>
  <!-- Statistics -->
  <div class="stats border border-base-300 w-full">
    <div class="stat">
      <div class="stat-figure text-primary">
        <box-icon name="calendar" size="lg"></box-icon>
      </div>
      <div class="stat-title">Total de periodos</div>
      <div class="stat-value text-primary">{{ data|length }}</div>
      <div class="stat-desc">Registrados en todo el tiempo</div>
    </div>
  </div>
</div>
<!-- Table -->
<div>
  <h2 class="my-8 text-2xl font-semibold">Vista general</h2>
  <div class="overflow-x-auto">
    <div id="periodos-table"></div>
  </div>
</div>
{% endblock %}
<!-- Scripts -->
{% block scripts %}
<script id="periodos-data" type="application/json">
  {{ data | tojson }}
</script>
<script>
  function formatDate(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString("es-BO", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric"
    });
  }

  function formatDateTime(dateString) {
    const date = new Date(dateString);
    return date.toLocaleDateString("es-BO", {
      day: "2-digit",
      month: "2-digit",
      year: "numeric"
    }) + " " + date.toLocaleTimeString("es-BO", {
      hour: "2-digit",
      minute: "2-digit"
    });
  }

  const jsonDataElement = document.getElementById("periodos-data");
  const rawData = JSON.parse(jsonDataElement.textContent);

  const grid = new gridjs.Grid({
    columns: ['ID', 'Fecha Inicio', 'Fecha Fin', 'Fecha Creaci贸n', 'Fecha Edici贸n', 'Acciones'],
    data: rawData.map(row => [
      row[0], // ID
      formatDate(row[1]), // Fecha Inicio
      formatDate(row[2]), // Fecha Fin
      formatDateTime(row[3]), // Fecha Creaci贸n
      formatDateTime(row[4]), // Fecha Edici贸n
      gridjs.html(`
        <div class="flex gap-2">
          <button class="btn btn-info" data-id="${row[0]}">Editar</button>
          <button class="btn btn-error" data-id="${row[0]}">Eliminar</button>
        </div>
      `)
    ]),
    search: true,
    pagination: { enabled: true, limit: 10 }
  });

  grid.render(document.getElementById("periodos-table"));
</script>
{% endblock %}
